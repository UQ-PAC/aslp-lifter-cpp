# aslp-lifter-cpp
This repository contains source files for an arm lifter, generated by [aslp]'s offline partial evaluation.

[aslp]: https://github.com/UQ-PAC/aslp

## lifter

The generated [`aslp_lifter`](subprojects/aslp-lifter/include/aslp/generated/aslp_lifter.hpp) is a polymorphic C++ class.
It has a type parameter to support retargeting the lifter to emit different IR targets (e.g. LLVM IR).
The methods which a backend interface must provide are declared in the [`lifter_interface`][]
class and further explained in the next section.

[`lifter_interface`]: subprojects/aslp-lifter/include/aslp/interface.hpp

The entry point of the lifter is `f_A64_decoder` which decodes the given opcode
and calls a lifter function for that particular encoding (e.g. `f_aarch64_branch_unconditional_immediate`).
Within this lifter method, methods from the lifter interface are called to implement the IR generation.

### interface

This sections describes the [`lifter_interface`][] in detail.
Within the lifter, there is a distinction between two different times of evaluation:
- **lift-time** refers to the execution of the C++ lifter itself. Since the opcode is given as an argument to the lifter functions, the opcode and anything derived from it is known at lift-time.
- **run-time** refers to the interpretation of the semantics (e.g. the LLVM IR). During run-time, values of registers and memory are available. Alternative interpretations might emit run-time code for other intermediate representations or even emulate the instruction in software.

This distinction is visible in the [`Traits`](subprojects/aslp-lifter/include/aslp/interface.hpp) template argument as rt and non-rt types, and it also appears in `llvm_interface` as "gen" and non-gen methods. You can also notice this split in the types of parameters and return types in llvm_interface.

### explicit instantiation

Since the lifter template is quite large, it takes a substantial amount of time to compile. Fortunately, we can parallelise 


## generating

At present, this repository is updated manually.
To do so, run this command from aslp's directory and replace $ASLP_LIFTER_CPP_DIR with this directory:
```bash
echo ':gen A64 .+ cpp $ASLP_LIFTER_CPP_DIR/subprojects/aslp-lifter' | dune exec asli
```
Then, make sure to add the `generated` subfolder changes with `-f`. To avoid cluttering git output, they are ignored by default.


## usage

To integrate the lifter with other applications, you can make use of the 
Meson and CMake files in this repository.

In Meson (preferred), we define two subprojects:
- _aslp-lifter_ is the main project, containing the lifter definition in header files, and
  source files to support explicit instantiation of the lifter template.

meson setup build $MESONFLAGS
meson compile -C build
